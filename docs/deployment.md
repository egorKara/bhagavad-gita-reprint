# Заметки по развертыванию проекта "Бхагавад-Гита как она есть" (1972 reprint)

## Общая информация

Этот документ описывает текущее состояние проекта и основные шаги для его развертывания и поддержки. Он создан для обеспечения возможности переноса проекта на другую платформу или восстановления его в случае необходимости.

## Структура репозитория

На данный момент проект использует одну ветку `main` для хранения файлов фронтенда и, потенциально, серверной логики (если она будет добавлена в будущем).

- `main`: Основная ветка, содержит файлы фронтенда (HTML, CSS, JS, изображения) и метаинформацию (README.md, LICENSE).
- `gh-pages`: Ветка, используемая для размещения статического сайта через GitHub Pages. Содержит те же файлы фронтенда, что и `main`, плюс файл `maintenance.html`.

## Настройка Git и GitHub

### SSH-ключи

Для аутентификации на GitHub с сервера был сгенерирован SSH-ключ.

- Публичный ключ: `~/.ssh/id_ed25519.pub`
- Команда генерации:
  ssh-keygen -t ed25519 -C "yc-user@server-for-gita-project" -f ~/.ssh/id_ed25519 -N ""

- Добавление ключа на GitHub: Публичный ключ был добавлен в настройки аккаунта GitHub (`Settings` -> `SSH and GPG keys`) под названием `Server-for-gita-project`.

### Удаленные репозитории

- Origin: `git@github.com:egorKara/bhagavad-gita-reprint.git` (SSH)

## Основные команды

### Переключение между ветками

# Переключиться на ветку main
 git checkout main

# Переключиться на ветку gh-pages
 git checkout gh-pages

### Работа с изменениями

# Добавить все изменения в индекс
 git add .

# Сделать коммит
 git commit -m "Описание изменений"

# Отправить изменения в удаленный репозиторий
 git push origin main

# или
 git push origin gh-pages

### Получение последних изменений

# Получить изменения из удаленного репозитория (без слияния)
 git fetch origin

# Получить и слить изменения из удаленной ветки
 git pull origin main

# или
 git pull origin gh-pages

## GitHub Pages

Сайт размещается по адресу: https://egorkara.github.io/bhagavad-gita-reprint/

Для внесения изменений в сайт, необходимо внести изменения в ветку `gh-pages` и отправить их на GitHub.

## Сервер (Yandex.Cloud)

На данный момент сервер используется для:
- Хранения локальной копии репозитория.
- Потенциального запуска серверной части проекта (Node.js, PostgreSQL).

**IP-адрес сервера**: 46.21.247.218
**Пользователь для подключения**: yc-user
**Команда для подключения по SSH**:

ssh -i ~/.ssh/ssh-key-1753182147967 yc-user@46.21.247.218

## Архитектура доменов (рекомендовано)

- Лендинг (GitHub Pages): `www.gita-1972-reprint.ru`
- Основной сайт (сервер): `gita-1972-reprint.ru`
- API (сервер): `api.gita-1972-reprint.ru`

### DNS записи

- `www.gita-1972-reprint.ru` → CNAME → `egorkara.github.io`
- `gita-1972-reprint.ru` → A → `46.21.247.218`
- `api.gita-1972-reprint.ru` → A → `46.21.247.218`

Почтовые записи (MX/TXT/SPF) оставьте без изменений.

### GitHub Pages (лендинг)

1. Ветка `gh-pages` публикуется через workflow; CNAME выставляется автоматически на `www.gita-1972-reprint.ru`.
2. В настройках репозитория включить GitHub Pages и HTTPS.
3. Все статические файлы лежат в `public/` и деплоятся в `gh-pages`.

### Сервер (основной сайт + API)

1. Репозиторий в `/srv/gita`, `.env` содержит `PORT=3000`.
2. Node/Express запускается systemd-сервисом `gita` (см. шаблон ниже).
3. Nginx обслуживает:
   - `gita-1972-reprint.ru` как статику из `/srv/gita/public` (HTTPS)
   - `api.gita-1972-reprint.ru` как прокси к `127.0.0.1:3000` (HTTPS)

Шаблоны конфигов лежат в `docs/nginx/`.

### Выпуск HTTPS сертификатов

Для каждого домена:
```
sudo apt-get install -y certbot python3-certbot-nginx
sudo certbot --nginx -d gita-1972-reprint.ru --non-interactive --agree-tos -m you@example.com
sudo certbot --nginx -d api.gita-1972-reprint.ru --non-interactive --agree-tos -m you@example.com
```

## Дальнейшие шаги

1.  **Добавление серверной части**: При разработке серверной логики (Node.js, API, работа с БД), файлы следует добавлять в ветку `main`.
2.  **Развертывание на сервере Yandex.Cloud**: Настроить Nginx для обслуживания статики и проксирования API по шаблонам из `docs/nginx/`.
3.  **CI/CD**: Настроены workflows на деплой `gh-pages` и линт; расширяйте по необходимости.

## Важно

Этот документ должен обновляться при внесении любых изменений в процесс развертывания или структуру проекта.
