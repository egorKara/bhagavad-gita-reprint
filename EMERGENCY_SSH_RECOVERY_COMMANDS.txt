# üö® –≠–ö–°–¢–†–ï–ù–ù–û–ï –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï SSH - –ö–û–ú–ê–ù–î–´ –î–õ–Ø –°–ï–†–ò–ô–ù–û–ô –ö–û–ù–°–û–õ–ò

# ==========================================
# –®–ê–ì 1: –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê SSH –°–ï–†–í–ò–°–ê
# ==========================================

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å SSH
sudo systemctl status ssh
sudo systemctl status sshd

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å UFW —Å—Ç–∞—Ç—É—Å
sudo ufw status

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 22
sudo ss -tlnp | grep :22

# ==========================================
# –®–ê–ì 2: –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï SSH
# ==========================================

# –ó–∞–ø—É—Å—Ç–∏—Ç—å SSH –µ—Å–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
sudo systemctl start ssh
sudo systemctl enable ssh

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å SSH —Å–µ—Ä–≤–∏—Å
sudo systemctl restart ssh

# ==========================================
# –®–ê–ì 3: –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï UFW
# ==========================================

# –ö–†–ò–¢–ò–ß–ù–û: –û—Ç–∫—Ä—ã—Ç—å SSH –ø–æ—Ä—Ç –ü–ï–†–í–´–ú!
sudo ufw allow 22/tcp
sudo ufw allow ssh

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ UFW
sudo ufw status numbered

# –ï—Å–ª–∏ UFW –æ—Ç–∫–ª—é—á–µ–Ω - –≤–∫–ª—é—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ
sudo ufw --force enable

# ==========================================
# –®–ê–ì 4: –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ê–ì–ï–ù–¢–ê
# ==========================================

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Yandex Server Agent
sudo systemctl restart yandex-server-agent
sudo systemctl status yandex-server-agent

# ==========================================
# –®–ê–ì 5: –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï
# ==========================================

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ SSH —Å–ª—É—à–∞–µ—Ç
sudo ss -tlnp | grep :22

# –¢–µ—Å—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
ssh localhost

# –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
sudo adduser testuser
sudo usermod -aG sudo testuser

# ==========================================
# –®–ê–ì 6: –ù–ê–°–¢–†–û–ô–ö–ê SSH –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò
# ==========================================

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSH –∫–æ–Ω—Ñ–∏–≥
sudo nano /etc/ssh/sshd_config

# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —ç—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã:
# Port 22
# PermitRootLogin no  
# PubkeyAuthentication yes
# PasswordAuthentication no

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
sudo systemctl restart ssh

# ==========================================
# –≠–ö–°–¢–†–ï–ù–ù–´–ï –ö–û–ú–ê–ù–î–´ –û–î–ù–û–ô –°–¢–†–û–ö–û–ô:
# ==========================================

sudo systemctl restart ssh && sudo ufw allow 22/tcp && sudo systemctl restart yandex-server-agent && sudo ss -tlnp | grep :22

# ==========================================
# –ï–°–õ–ò –í–°–ï –†–ê–ë–û–¢–ê–ï–¢ - –°–û–û–ë–©–ò –í TELEGRAM:
# ==========================================

echo "SSH –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù!" | tee /tmp/recovery-success.txt
