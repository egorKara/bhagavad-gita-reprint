#!/usr/bin/env sh

# üîç Modern Husky v9+ Pre-commit Hook
# –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

echo "üöÄ Pre-commit –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–ø—É—â–µ–Ω—ã..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–µ—Å–ª–∏ lint-staged —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
if command -v npx >/dev/null 2>&1; then
    if npx lint-staged --version >/dev/null 2>&1; then
        echo "üìù –õ–∏–Ω—Ç–∏–Ω–≥ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤..."
        npx lint-staged
    else
        echo "‚ö†Ô∏è lint-staged –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ª–∏–Ω—Ç–∏–Ω–≥"
    fi
fi

# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ Node.js —Ñ–∞–π–ª–æ–≤
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ Node.js..."
if command -v node >/dev/null 2>&1; then
    for file in $(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(js|mjs)$'); do
        if [ -f "$file" ]; then
            node -c "$file" || exit 1
        fi
    done
fi

echo "‚úÖ Pre-commit –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!"