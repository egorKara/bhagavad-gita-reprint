# üö® –≠–ö–°–¢–†–ï–ù–ù–´–ï –ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–û –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Æ API

## ‚ö†Ô∏è **–ü–†–û–ë–õ–ï–ú–ê**
API —Å–µ—Ä–≤–µ—Ä `https://api.gita-1972-reprint.ru/` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **502 Bad Gateway**, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ Nginx –Ω–µ –º–æ–∂–µ—Ç —Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è —Å backend —Å–µ—Ä–≤–∏—Å–æ–º (Node.js API).

---

## üîß **–ë–´–°–¢–†–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (5 –º–∏–Ω—É—Ç)**

### **–®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É**
```bash
ssh root@your-server-ip
# –∏–ª–∏
ssh ubuntu@your-server-ip
```

### **–®–∞–≥ 2: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è**
```bash
# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /var/www/gita-1972-reprint

# –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
git pull origin main

# –ó–∞–ø—É—Å–∫ —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
bash deployment/api-emergency-fix.sh auto
```

**–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- ‚úÖ –ü—Ä–æ–≤–µ–¥–µ—Ç –ø–æ–ª–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç systemd —Å–µ—Ä–≤–∏—Å
- ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç API —Å–µ—Ä–≤–µ—Ä
- ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç Nginx
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

---

## üîç **–†–£–ß–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê**

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤**
```bash
systemctl status nginx
systemctl status gita-api
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –°–ª—É—à–∞—é—Ç—Å—è –ª–∏ –ø–æ—Ä—Ç—ã**
```bash
ss -tulpn | grep -E ":(80|443|3000) "
```
**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ü–æ—Ä—Ç 80: nginx
- ‚úÖ –ü–æ—Ä—Ç 443: nginx  
- ‚úÖ –ü–æ—Ä—Ç 3000: node (API)

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –ü—Ä–æ—Ü–µ—Å—Å—ã Node.js**
```bash
ps aux | grep -v grep | grep "node.*server.js"
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ 4: –õ–æ–≥–∏ –æ—à–∏–±–æ–∫**
```bash
# Nginx –æ—à–∏–±–∫–∏
tail -20 /var/log/nginx/error.log

# –°–∏—Å—Ç–µ–º–Ω—ã–µ –æ—à–∏–±–∫–∏
journalctl -u gita-api --since "1 hour ago"

# –û—à–∏–±–∫–∏ API
journalctl -u gita-api -f
```

---

## üõ†Ô∏è **–†–£–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï**

### **–í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ–±–ª–µ–º–∞ —Å systemd —Å–µ—Ä–≤–∏—Å–æ–º**

#### **1.1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞**
```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å–µ—Ä–≤–∏—Å–∞
sudo cp /var/www/gita-1972-reprint/deployment/gita-api.service /etc/systemd/system/

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ systemd
sudo systemctl daemon-reload

# –í–∫–ª—é—á–µ–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫
sudo systemctl enable gita-api
sudo systemctl start gita-api
```

#### **1.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞**
```bash
sudo systemctl status gita-api
```

### **–í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ Node.js**

#### **2.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Node.js**
```bash
node --version
npm --version
```

#### **2.2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
```bash
cd /var/www/gita-1972-reprint
npm install --production
```

#### **2.3. –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫**
```bash
# –¢–µ—Å—Ç API
node src/server.js &
sleep 5
curl http://localhost:3000/api/status
```

### **–í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞**

#### **3.1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞**
```bash
sudo chown -R www-data:www-data /var/www/gita-1972-reprint
sudo chmod -R 755 /var/www/gita-1972-reprint
```

#### **3.2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ .env —Ñ–∞–π–ª–∞**
```bash
sudo chmod 600 /var/www/gita-1972-reprint/.env
sudo chown www-data:www-data /var/www/gita-1972-reprint/.env
```

### **–í–∞—Ä–∏–∞–Ω—Ç 4: –ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π Nginx**

#### **4.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
```bash
sudo nginx -t
```

#### **4.2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo cp /var/www/gita-1972-reprint/deployment/nginx-ssl.conf /etc/nginx/sites-available/api.gita-1972-reprint.ru

# –í–∫–ª—é—á–µ–Ω–∏–µ —Å–∞–π—Ç–∞
sudo ln -sf /etc/nginx/sites-available/api.gita-1972-reprint.ru /etc/nginx/sites-enabled/

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ nginx
sudo systemctl restart nginx
```

---

## ‚úÖ **–ü–†–û–í–ï–†–ö–ê –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø**

### **1. –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**
```bash
curl http://localhost:3000/api/status
```
**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:** `{"status":"ok","timestamp":"..."}`

### **2. –í–Ω–µ—à–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞**
```bash
curl https://api.gita-1972-reprint.ru/api/status
```

### **3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ**
–û—Ç–∫—Ä–æ–π—Ç–µ: `https://api.gita-1972-reprint.ru/api/status`

---

## üö® **–ï–°–õ–ò –ù–ò–ß–ï–ì–û –ù–ï –ü–û–ú–û–ì–ê–ï–¢**

### **–ö—Ä–∞–π–Ω–∏–µ –º–µ—Ä—ã:**

#### **1. –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–∞**
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ–≥–æ
sudo systemctl stop gita-api nginx
sudo pkill -f "node.*server.js"

# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞
cd /var/www/gita-1972-reprint
bash deployment/install-service.sh

# –ó–∞–ø—É—Å–∫
sudo systemctl start nginx gita-api
```

#### **2. –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏**
```bash
cd /var/www/gita-1972-reprint
sudo -u www-data NODE_ENV=production PORT=3000 node src/server.js
```

#### **3. –ü—Ä–æ–≤–µ—Ä–∫–∞ firewall**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ UFW
sudo ufw status

# –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ—Ä—Ç–æ–≤ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
sudo ufw allow 80
sudo ufw allow 443
sudo ufw allow 3000
```

---

## üìû **–ö–û–ù–¢–ê–ö–¢–´ –î–õ–Ø –≠–ö–°–¢–†–ï–ù–ù–û–ô –ü–û–ú–û–©–ò**

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è:

1. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ª–æ–≥–∏:**
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ –ª–æ–≥–æ–≤
tar -czf /tmp/gita-debug-$(date +%Y%m%d_%H%M%S).tar.gz \
    /var/log/nginx/ \
    /var/log/journal/ \
    /var/www/gita-1972-reprint/.env \
    /etc/nginx/sites-available/api.gita-1972-reprint.ru
```

2. **–°–æ–∑–¥–∞–π—Ç–µ –æ—Ç—á–µ—Ç:**
```bash
bash /var/www/gita-1972-reprint/deployment/api-emergency-fix.sh report
```

3. **–ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:**
   - –í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã: `lsb_release -a`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤: `df -h && free -h`
   - –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤: `systemctl status nginx gita-api`

---

## ‚è∞ **–í–†–ï–ú–ï–ù–ù–ê–Ø –ú–ï–†–ê**

–ï—Å–ª–∏ API –∫—Ä–∏—Ç–∏—á–Ω–æ –Ω—É–∂–µ–Ω –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å:

```bash
# –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫ –±–µ–∑ systemd
cd /var/www/gita-1972-reprint
nohup node src/server.js > /var/log/gita-api-manual.log 2>&1 &
```

**‚ö†Ô∏è –ü–æ–º–Ω–∏—Ç–µ:** –≠—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ. –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ systemd —Å–µ—Ä–≤–∏—Å.

---

## üéØ **–£–°–ü–ï–•!**

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è API –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å:
- ‚úÖ `https://api.gita-1972-reprint.ru/api/status` ‚Üí `{"status":"ok"}`
- ‚úÖ –ë–µ–∑ –æ—à–∏–±–æ–∫ 502 Bad Gateway
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–ª–∏–∫ (< 1 —Å–µ–∫—É–Ω–¥—ã)

**üéâ API –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!**
