# üîß –£–ü–†–ê–í–õ–ï–ù–ò–ï –û–ë–ù–û–í–õ–ï–ù–ò–Ø–ú–ò - Yandex Server Agent

## üìã –û–±–∑–æ—Ä

Yandex Server Agent —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ —Å–∏—Å—Ç–µ–º—ã Ubuntu, –≤–∫–ª—é—á–∞—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø–∞–∫–µ—Ç–æ–≤.

---

## ‚ú® –í–û–ó–ú–û–ñ–ù–û–°–¢–ò –ê–í–¢–û–û–ë–ù–û–í–õ–ï–ù–ò–ô

### üîí **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω—ã)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–∏—Å–æ–≤

### üì¶ **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫–ª—é—á–µ–Ω—ã)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
- –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç–æ–≤ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### üïí **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π**
- **–ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 3:00 MSK:** –ü–æ–ª–Ω–æ–µ —Å–∏—Å—Ç–µ–º–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
- **–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ:** –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –∏ –Ω–µ–Ω—É–∂–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤

---

## ‚öôÔ∏è –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

### üìÑ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `agent-config.json`:

```json
{
  "automation": {
    "auto_security_updates": true,      // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    "auto_package_updates": false,      // –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤ (–æ—Ç–∫–ª—é—á–µ–Ω–æ)
    "auto_reboot": false               // –ê–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ (–æ—Ç–∫–ª—é—á–µ–Ω–∞)
  },
  "update_policy": {
    "enabled": true,
    "security_updates": true,
    "package_updates": false,
    "allowed_packages": [               // –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞–∫–µ—Ç—ã
      "python3",
      "python3-pip", 
      "nginx",
      "curl",
      "git",
      "certbot"
    ],
    "excluded_packages": [              // –ò—Å–∫–ª—é—á–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
      "linux-*",
      "kernel-*", 
      "grub-*"
    ],
    "maintenance_window": {
      "enabled": true,
      "start_time": "03:00",
      "end_time": "05:00",
      "timezone": "Europe/Moscow",
      "days": ["sunday"]
    }
  }
}
```

---

## üöÄ –§–£–ù–ö–¶–ò–ò –ê–ì–ï–ù–¢–ê

### üîç **check_system_updates()**
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ:
```bash
sudo apt update -qq
apt list --upgradable
```

### üîí **install_security_updates()**
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
```bash
sudo unattended-upgrade -d
# –∏–ª–∏
sudo apt upgrade -y --with-new-pkgs
```

### üì¶ **install_package_updates(allowed_packages)**
–û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã:
```bash
sudo apt install --only-upgrade -y python3 nginx curl git
```

### üßπ **cleanup_after_updates()**
–û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:
```bash
sudo apt autoremove -y
sudo apt autoclean
```

### üîß **perform_system_maintenance()**
–ü–æ–ª–Ω–æ–µ —Å–∏—Å—Ç–µ–º–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
- –û—á–∏—Å—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

---

## üéõÔ∏è –£–ü–†–ê–í–õ–ï–ù–ò–ï

### **–í–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø–∞–∫–µ—Ç–æ–≤:**
```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
nano /home/yc-user/gita-1972/server-agent/agent-config.json

# –ò–∑–º–µ–Ω–∏—Ç—å:
"auto_package_updates": true

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞
sudo systemctl restart yandex-server-agent
```

### **–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è:**
```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh -i ~/.ssh/ssh-key-1753182147967 yc-user@46.21.247.218

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
sudo apt update && apt list --upgradable

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
sudo unattended-upgrade -d

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
sudo apt install --only-upgrade python3 nginx
```

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:**
```bash
# –õ–æ–≥–∏ –∞–≥–µ–Ω—Ç–∞
journalctl -u yandex-server-agent -f | grep -E "(–æ–±–Ω–æ–≤–ª–µ–Ω|update|upgrade)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
ls -la /var/run/reboot-required

# –ò—Å—Ç–æ—Ä–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
cat /var/log/apt/history.log | tail -20
```

---

## ‚ö†Ô∏è –ü–û–õ–ò–¢–ò–ö–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### ‚úÖ **–ß—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Ubuntu
- Python 3 –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
- Nginx –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
- –£—Ç–∏–ª–∏—Ç—ã: curl, git, certbot

### ‚ùå **–ß—Ç–æ –ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- –Ø–¥—Ä–æ Linux (linux-*, kernel-*)
- –ó–∞–≥—Ä—É–∑—á–∏–∫ GRUB (grub-*)
- –°–∏—Å—Ç–µ–º–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (—Ç—Ä–µ–±—É—é—â–∏–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏)
- –ü–∞–∫–µ—Ç—ã, –Ω–µ –≤—Ö–æ–¥—è—â–∏–µ –≤ allowed_packages

### üõ°Ô∏è **–ú–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
- –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π  
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ (—Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –û–¢–ß–ï–¢–´

### **–õ–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:**
- **–ê–≥–µ–Ω—Ç:** `/home/yc-user/gita-1972/logs/server-agent.log`
- **–°–∏—Å—Ç–µ–º–∞:** `journalctl -u yandex-server-agent`
- **APT:** `/var/log/apt/history.log`

### **–û—Ç—á–µ—Ç—ã –∞–≥–µ–Ω—Ç–∞:**
```bash
# –°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
cat /home/yc-user/gita-1972/logs/agent-status.json | jq '.maintenance'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
cat /home/yc-user/gita-1972/logs/server-agent.log | grep -E "Found.*updates"
```

### **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
–ê–≥–µ–Ω—Ç –ª–æ–≥–∏—Ä—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Å–æ–±—ã—Ç–∏—è:
- üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- üì¶ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è  
- ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- ‚ùå –û—à–∏–±–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚ö†Ô∏è –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

---

## üö® –≠–ö–°–¢–†–ï–ù–ù–´–ï –ü–†–û–¶–ï–î–£–†–´

### **–û—Ç–∫–∞—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:**
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏
sudo apt-cache policy package_name

# –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
sudo apt install package_name=version

# –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–∞ –æ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
sudo apt-mark hold package_name
```

### **–ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏:**
```bash
# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ–º–∞–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
sudo apt --fix-broken install

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
sudo dpkg --configure -a

# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
sudo apt clean && sudo apt update
```

### **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:**
```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
sudo cp /home/yc-user/gita-1972/backups/config/* /etc/

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
sudo systemctl restart nginx gita-api yandex-server-agent
```

---

## üìà –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### **–î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω —Å—Ä–µ–¥—ã:**
1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –°–Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ staging
2. **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ maintenance window
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
4. **Backup:** –î–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –ø–µ—Ä–µ–¥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏

### **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –Ω–∞–≥—Ä—É–∑–æ–∫:**
- **–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:** –û—Ç–∫–ª—é—á–∏—Ç–µ auto_package_updates
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º—ã:** –û—Ç–∫–ª—é—á–∏—Ç–µ auto_security_updates  
- **Dev/Test —Å—Ä–µ–¥—ã:** –í–∫–ª—é—á–∏—Ç–µ –≤—Å–µ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
- –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ñ–æ–Ω–µ
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã

---

*–°–æ–∑–¥–∞–Ω–æ: 26 –∞–≤–≥—É—Å—Ç–∞ 2025*  
*–í–µ—Ä—Å–∏—è: 1.0*  
*–°—Ç–∞—Ç—É—Å: –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å*
