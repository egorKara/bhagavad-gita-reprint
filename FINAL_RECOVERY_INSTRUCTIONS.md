# ๐ ะคะะะะะฌะะซะ ะะะกะขะะฃะะฆะะ ะะ ะะะกะกะขะะะะะะะะะฎ API

## ๐ฏ ะกะขะะขะฃะก ะะ ะะะะฃะกะข 2025

**โ ะะซะะะะะะะ ะ DEV ะกะะะะ:**
- API ัะตัะฒะตั ััะฟะตัะฝะพ ะทะฐะฟััะตะฝ ะธ ัะฐะฑะพัะฐะตั
- Nginx ะบะพะฝัะธะณััะฐัะธั ะฟัะพะฒะตัะตะฝะฐ
- ะัะต endpoints ะพัะฒะตัะฐัั ะบะพััะตะบัะฝะพ
- ะะธะฐะณะฝะพััะธัะตัะบะธะต ะธะฝััััะผะตะฝัั ะฟัะพัะตััะธัะพะฒะฐะฝั

**โ๏ธ ะขะะะะฃะะข ะะซะะะะะะะะฏ ะะ ะะะะะะะจะ ะกะะะะะะ:**
- ะัะธะผะตะฝะธัั ะธัะฟัะฐะฒะปะตะฝะธะต ES modules
- ะะตัะตะทะฐะฟัััะธัั systemd ัะตัะฒะธั
- ะะฑะฝะพะฒะธัั SSL ัะตััะธัะธะบะฐัั

---

## ๐ง ะะะะขะะงะะกะะะ ะะกะะะะะะะะะ

### **ะัะพะฑะปะตะผะฐ:** 
API ะฝะต ะทะฐะฟััะบะฐะตััั ะธะท-ะทะฐ ะบะพะฝัะปะธะบัะฐ ES modules ะฒ package.json

### **ะะตัะตะฝะธะต:**
```bash
# ะฃะฑัะฐัั ัััะพะบั "type": "module" ะธะท package.json
sed -i '/"type": "module",/d' package.json
```

---

## ๐ ะะะจะะะะะซะ ะะะะะะะซ ะะะฏ ะะะะะะะจะ ะกะะะะะะ

### **1. ะะพะดะบะปััะตะฝะธะต ะบ ัะตัะฒะตัั**
```bash
ssh root@your-server-ip
# ะธะปะธ
ssh your-username@your-server-ip
```

### **2. ะะตัะตัะพะด ะฒ ะดะธัะตะบัะพัะธั ะฟัะพะตะบัะฐ**
```bash
cd /var/www/gita-1972-reprint
```

### **3. ะัะธะผะตะฝะตะฝะธะต ะบัะธัะธัะตัะบะพะณะพ ะธัะฟัะฐะฒะปะตะฝะธั**
```bash
# ะกะพะทะดะฐัั ัะตะทะตัะฒะฝัั ะบะพะฟะธั
cp package.json package.json.backup

# ะัะธะผะตะฝะธัั ะธัะฟัะฐะฒะปะตะฝะธะต
sed -i '/"type": "module",/d' package.json

# ะัะพะฒะตัะธัั ะธะทะผะตะฝะตะฝะธั
grep -n "type" package.json || echo "ะัะฟัะฐะฒะปะตะฝะธะต ะฟัะธะผะตะฝะตะฝะพ"
```

### **4. ะััะฐะฝะพะฒะบะฐ ะบะพะฝัะปะธะบััััะธั ะฟัะพัะตััะพะฒ**
```bash
# ะััะฐะฝะพะฒะธัั ะฒัะต ะฟัะพัะตััั Node.js
sudo pkill -f "node.*server.js"

# ะััะฐะฝะพะฒะธัั systemd ัะตัะฒะธั
sudo systemctl stop gita-api

# ะัะพะฒะตัะธัั ััะพ ะฟะพัั ัะฒะพะฑะพะดะตะฝ
sudo ss -tulpn | grep ":3000" || echo "ะะพัั 3000 ัะฒะพะฑะพะดะตะฝ"
```

### **5. ะะตัะตะทะฐะฟััะบ API ัะตัะฒะธัะฐ**
```bash
# ะะฐะฟัััะธัั systemd ัะตัะฒะธั
sudo systemctl start gita-api

# ะัะพะฒะตัะธัั ััะฐััั
sudo systemctl status gita-api

# ะัะปะธ ะฒัะต ัะพัะพัะพ, ะฒะบะปััะธัั ะฐะฒัะพะทะฐะฟััะบ
sudo systemctl enable gita-api
```

### **6. ะัะพะฒะตัะบะฐ ัะฐะฑะพัะพัะฟะพัะพะฑะฝะพััะธ**
```bash
# ะะพะบะฐะปัะฝะฐั ะฟัะพะฒะตัะบะฐ
curl http://localhost:3000/api/status
curl http://localhost:3000/livez
curl http://localhost:3000/readyz

# ะะฝะตัะฝัั ะฟัะพะฒะตัะบะฐ
curl https://api.gita-1972-reprint.ru/api/status
curl https://gita-1972-reprint.ru/
```

---

## ๐ SSL ะกะะะขะะคะะะะขะซ

### **ะัะพะฒะตัะบะฐ ัะตะบััะธั ัะตััะธัะธะบะฐัะพะฒ**
```bash
sudo certbot certificates
```

### **ะะฑะฝะพะฒะปะตะฝะธะต ัะตััะธัะธะบะฐัะพะฒ (ะตัะปะธ ะฝัะถะฝะพ)**
```bash
# ะะฑะฝะพะฒะธัั ะฒัะต ัะตััะธัะธะบะฐัั
sudo certbot renew

# ะกะพะทะดะฐัั ะฝะพะฒัะต (ะตัะปะธ ะฝัะถะฝะพ)
sudo certbot --nginx -d api.gita-1972-reprint.ru -d gita-1972-reprint.ru

# ะัะพะฒะตัะธัั Nginx ะบะพะฝัะธะณััะฐัะธั
sudo nginx -t

# ะะตัะตะทะฐะณััะทะธัั Nginx
sudo systemctl reload nginx
```

---

## ๐ ะญะะกะขะะะะะซะ ะะะกะขะะฃะะะะขะซ

### **ะัะปะธ ััะพ-ัะพ ะฟะพะนะดะตั ะฝะต ัะฐะบ:**

#### **ะะพะปะฝะพะต ัะบัััะตะฝะฝะพะต ะฒะพัััะฐะฝะพะฒะปะตะฝะธะต**
```bash
sudo bash deployment/api-emergency-fix.sh
```

#### **ะขะพะปัะบะพ ะดะธะฐะณะฝะพััะธะบะฐ**
```bash
sudo bash deployment/api-emergency-fix.sh diagnose
```

#### **ะัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั ัะธััะตะผั**
```bash
bash deployment/health-check.sh
```

#### **ะะฝัะตัะฐะบัะธะฒะฝัะน ะดะฐัะฑะพัะด**
```bash
bash deployment/server-dashboard.sh
```

#### **ะะพะฝะธัะพัะธะฝะณ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ**
```bash
bash deployment/server-monitor.sh
```

---

## โ ะะะะะะะะซะ ะะะะฃะะฌะขะะขะซ

ะะพัะปะต ััะฟะตัะฝะพะณะพ ะฒัะฟะพะปะฝะตะฝะธั ะฒั ะดะพะปะถะฝั ัะฒะธะดะตัั:

### **ะกัะฐััั ัะตัะฒะธัะพะฒ:**
```bash
sudo systemctl status nginx gita-api
# ะะฑะฐ ะดะพะปะถะฝั ะฑััั active (running)
```

### **ะะพััั:**
```bash
sudo ss -tulpn | grep -E ":(80|443|3000)"
# ะัะต ััะธ ะฟะพััะฐ ะดะพะปะถะฝั ัะปััะฐัััั
```

### **API ัะตััั:**
```bash
curl http://localhost:3000/api/status
# ะะพะปะถะตะฝ ะฒะตัะฝััั: {"status":"OK","message":"ะกะตัะฒะตั ัะฐะฑะพัะฐะตั ะบะพััะตะบัะฝะพ"...}

curl https://api.gita-1972-reprint.ru/api/status  
# ะะพะปะถะตะฝ ัะฐะฑะพัะฐัั ัะตัะตะท HTTPS
```

---

## ๐จ ะฃะกะขะะะะะะะ ะะะะะะะ

### **ะัะปะธ API ะฒัะต ะตัะต ะฝะต ะทะฐะฟััะบะฐะตััั:**

1. **ะัะพะฒะตัะธัั ะปะพะณะธ:**
   ```bash
   sudo journalctl -u gita-api -f
   ```

2. **ะัะพะฒะตัะธัั ะฟะพัั:**
   ```bash
   sudo lsof -i :3000
   ```

3. **ะะฐะฟัััะธัั ะฒัััะฝัั ะดะปั ะพัะปะฐะดะบะธ:**
   ```bash
   cd /var/www/gita-1972-reprint
   node src/server.js
   ```

4. **ะัะพะฒะตัะธัั ะฟัะฐะฒะฐ ะดะพัััะฟะฐ:**
   ```bash
   sudo chown -R www-data:www-data /var/www/gita-1972-reprint
   sudo chmod +x deployment/*.sh
   ```

### **ะัะปะธ Nginx ะฝะต ัะฐะฑะพัะฐะตั:**

1. **ะัะพะฒะตัะธัั ะบะพะฝัะธะณััะฐัะธั:**
   ```bash
   sudo nginx -t
   ```

2. **ะะพัััะฐะฝะพะฒะธัั ะบะพะฝัะธะณััะฐัะธั:**
   ```bash
   sudo cp deployment/nginx-ssl.conf /etc/nginx/sites-available/api.gita-1972-reprint.ru
   sudo ln -sf /etc/nginx/sites-available/api.gita-1972-reprint.ru /etc/nginx/sites-enabled/
   sudo systemctl restart nginx
   ```

---

## ๐ ะะะะะขะะะะะ ะะะกะะ ะะะกะกะขะะะะะะะะะฏ

### **ะะฐัััะพะนะบะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธั ะฟัะพะฒะตัะพะบ:**
```bash
# ะะพะฑะฐะฒะธัั ะฒ crontab
sudo crontab -e

# ะะพะฑะฐะฒะธัั ััะธ ัััะพะบะธ:
*/15 * * * * /home/user/gita-1972-reprint/deployment/health-check.sh >/dev/null 2>&1
0 2 * * 0 /home/user/gita-1972-reprint/deployment/server-cleanup.sh >/dev/null 2>&1
0 3 * * * /usr/bin/certbot renew --quiet
```

### **ะัะพะฒะตัะบะฐ ะปะพะณะพะฒ:**
```bash
# API ะปะพะณะธ
sudo journalctl -u gita-api --since today

# Nginx ะปะพะณะธ  
sudo tail -f /var/log/nginx/error.log

# ะกะธััะตะผะฝัะต ะปะพะณะธ
sudo journalctl --since "1 hour ago" --priority=err
```

---

## ๐ฏ ะะขะะะะะะฏ ะะะะะะะะ

ะะพัะปะต ะฒัะฟะพะปะฝะตะฝะธั ะฒัะตั ัะฐะณะพะฒ ะทะฐะฟัััะธัะต ัะธะฝะฐะปัะฝัั ะฟัะพะฒะตัะบั:

```bash
echo "๐ฏ ะคะะะะะฌะะะฏ ะะะะะะะะ:"
echo "===================="

echo "ะกะตัะฒะธัั:"
sudo systemctl is-active nginx && echo "โ Nginx" || echo "โ Nginx"
sudo systemctl is-active gita-api && echo "โ API" || echo "โ API"

echo "ะะพััั:"
sudo ss -tulpn | grep ":80" && echo "โ HTTP" || echo "โ HTTP"
sudo ss -tulpn | grep ":443" && echo "โ HTTPS" || echo "โ HTTPS"  
sudo ss -tulpn | grep ":3000" && echo "โ API" || echo "โ API"

echo "API ัะตััั:"
curl -s http://localhost:3000/api/status >/dev/null && echo "โ ะะพะบะฐะปัะฝัะน API" || echo "โ ะะพะบะฐะปัะฝัะน API"
curl -s https://api.gita-1972-reprint.ru/api/status >/dev/null && echo "โ ะะฝะตัะฝะธะน API" || echo "โ ะะฝะตัะฝะธะน API"

echo "๐ ะะพัััะฐะฝะพะฒะปะตะฝะธะต ะทะฐะฒะตััะตะฝะพ!"
```

---

**๐ ะะะะะะะะะ:**
- ะะพะบัะผะตะฝัะฐัะธั: `/var/www/gita-1972-reprint/deployment/`
- ะะพะณะธ ัะบัััะตะฝะฝะพะณะพ ะฒะพัััะฐะฝะพะฒะปะตะฝะธั: `/var/log/api-emergency-fix.log`
- ะััะตัั ะพ ะทะดะพัะพะฒัะต: `/tmp/health-report-*.txt`

**๐ ะฃะกะะะฅะะ ะ ะะะกะกะขะะะะะะะะะ! ๐**
